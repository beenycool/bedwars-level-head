<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Test Copy Button</title>
  <style>
      body { background: #0f172a; color: #e2e8f0; font-family: sans-serif; padding: 20px; }
      .copy-btn {
        background: transparent;
        border: none;
        color: #64748b;
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: color 0.2s, background 0.2s;
        opacity: 0.6;
        border: 1px solid #334155;
      }
      .copy-btn:hover {
        color: #cbd5f5;
        background: rgba(255, 255, 255, 0.1);
        opacity: 1;
      }
      .copy-btn svg {
        width: 14px;
        height: 14px;
        fill: currentColor;
      }
      .copy-btn.copied {
        color: #4ade80;
        opacity: 1;
      }
  </style>
</head>
<body>
  <h1>Test Copy Button</h1>
  <p>Click the buttons below to copy.</p>
  <button class="copy-btn" aria-label="Copy identifier" title="Copy identifier" data-copy="TestUUID1">
    <svg aria-hidden="true" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
  </button>
  <button class="copy-btn" aria-label="Copy identifier" title="Copy identifier" data-copy="TestUUID2">
    <svg aria-hidden="true" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
  </button>

  <script>
      // Paste exact JS logic here
      document.addEventListener('click', async (e) => {
        const btn = e.target.closest('.copy-btn');
        if (!btn) return;

        // Prevent re-entry on this specific button
        if (btn.dataset.copying === 'true') return;

        const text = btn.getAttribute('data-copy');
        if (!text) return;

        // Lock this button
        btn.dataset.copying = 'true';
        const originalHtml = btn.innerHTML;
        const originalLabel = btn.getAttribute('aria-label');
        const originalTitle = btn.getAttribute('title');

        try {
          await navigator.clipboard.writeText(text);
          btn.classList.add('copied');
          btn.setAttribute('aria-label', 'Copied');
          btn.setAttribute('title', 'Copied');
          // Checkmark icon
          btn.innerHTML = '<svg aria-hidden="true" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>';

          setTimeout(() => {
            btn.innerHTML = originalHtml;
            btn.classList.remove('copied');

            if (originalLabel) {
              btn.setAttribute('aria-label', originalLabel);
            } else {
              btn.removeAttribute('aria-label');
            }

            if (originalTitle) {
              btn.setAttribute('title', originalTitle);
            } else {
              btn.removeAttribute('title');
            }

            delete btn.dataset.copying;
          }, 2000);
        } catch (err) {
          console.error('Failed to copy', err);
          delete btn.dataset.copying;
        }
      });
  </script>
</body>
</html>
